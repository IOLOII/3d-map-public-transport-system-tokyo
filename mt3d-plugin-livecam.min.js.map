{"version":3,"file":"mt3d-plugin-livecam.min.js","sources":["../node_modules/style-inject/dist/style-inject.es.js","../src/index.js","../node_modules/@fortawesome/fontawesome-free/svgs/solid/video.svg"],"sourcesContent":["function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","import {Marker, Panel, Popup} from 'mini-tokyo-3d';\nimport livecamSVG from '@fortawesome/fontawesome-free/svgs/solid/video.svg';\nimport './livecam.css';\n\n// Live camera URL\nconst LIVECAM_URL = 'https://mini-tokyo.appspot.com/livecam';\n\nfunction addColor(url, color) {\n    const encodedColor = color.replace('#', '%23');\n    return url.replace('%3e', ` fill=\\'${encodedColor}\\' stroke=\\'${encodedColor}\\'%3e`);\n}\n\nfunction createElement(tagName, attributes, container) {\n    const element = document.createElement(tagName);\n\n    Object.assign(element, attributes);\n    if (container) {\n        container.appendChild(element);\n    }\n    return element;\n}\n\nclass LivecamPanel extends Panel {\n\n    constructor(options) {\n        super(Object.assign({className: 'livecam-panel'}, options));\n    }\n\n    addTo(map) {\n        const me = this,\n            {name, html} = me._options.camera;\n\n        me.setTitle(name[map.lang])\n            .setHTML(html);\n        return super.addTo(map);\n    }\n\n}\n\nclass LivecamPlugin {\n\n    constructor() {\n        const me = this;\n\n        me.id = 'livecam';\n        me.name = {\n            en: 'Live Cameras',\n            ja: 'ライブカメラ',\n            ko: '실시간 웹캠',\n            ne: 'प्रत्यक्ष क्यामेरा',\n            pt: 'Câmeras ao vivo',\n            th: 'กล้องถ่ายทอดสด',\n            'zh-Hans': '实时摄像头',\n            'zh-Hant': '實時攝像頭'\n        };\n        me.iconStyle = {\n            backgroundSize: '32px',\n            backgroundImage: `url(\"${addColor(livecamSVG, 'white')}\")`\n        };\n        me.clockModes = ['realtime'];\n        me.viewModes = ['ground'];\n        me.cameras = {};\n        me.markers = {};\n        me._onSelection = me._onSelection.bind(me);\n        me._onDeselection = me._onDeselection.bind(me);\n    }\n\n    onAdd(map) {\n        this.map = map;\n    }\n\n    onEnabled() {\n        const me = this,\n            {map, cameras} = me;\n\n        map.on('selection', me._onSelection);\n        map.on('deselection', me._onDeselection);\n\n        fetch(LIVECAM_URL).then(response => response.json()).then(data => {\n            for (const item of data) {\n                cameras[item.id] = item;\n            }\n            me._addMarkers();\n        });\n    }\n\n    onDisabled() {\n        const me = this,\n            {map} = me;\n\n        map.off('selection', me._onSelection);\n        map.off('deselection', me._onDeselection);\n\n        if (me.panel) {\n            map.trackObject();\n            me.panel.remove();\n            delete me.panel;\n        }\n\n        for (const id of Object.keys(me.cameras)) {\n            delete me.cameras[id];\n        }\n        for (const id of Object.keys(me.markers)) {\n            me.markers[id].remove();\n            delete me.markers[id];\n        }\n    }\n\n    onVisibilityChanged(visible) {\n        const me = this;\n\n        me.visible = visible;\n\n        if (!visible && me.panel) {\n            me.map.trackObject();\n        }\n        for (const id of Object.keys(me.markers)) {\n            me.markers[id].setVisibility(visible);\n        }\n    }\n\n    _addMarkers() {\n        const me = this,\n            {map, visible} = me,\n            {lang} = map;\n\n        for (const id of Object.keys(me.cameras)) {\n            const {center, zoom, bearing, pitch, name, thumbnail} = me.cameras[id],\n                element = createElement('div', {className: 'livecam-marker'}),\n                selection = {id, selectionType: 'livecam'};\n            let popup;\n\n            me.markers[id] = new Marker({element})\n                .setLngLat(center)\n                .addTo(map)\n                .setVisibility(visible)\n                .on('click', () => {\n                    map.trackObject(selection);\n                    map.getMapboxMap().flyTo({center, zoom, bearing, pitch});\n                })\n                .on('mouseenter', () => {\n                    popup = new Popup()\n                        .setLngLat(center)\n                        .setHTML([\n                            '<div class=\"thumbnail-image-container\">',\n                            '<div class=\"ball-pulse\"><div></div><div></div><div></div></div>',\n                            `<div class=\"thumbnail-image\" style=\"background-image: url(\\'${thumbnail}\\');\"></div>`,\n                            '</div>',\n                            `<div><strong>${name[lang]}</strong></div>`\n                        ].join(''))\n                        .addTo(map);\n                })\n                .on('mouseleave', () => {\n                    if (popup) {\n                        popup.remove();\n                        popup = undefined;\n                    }\n                });\n        }\n    }\n\n    _onSelection(event) {\n        if (event.selectionType === 'livecam') {\n            const me = this,\n                {id} = event;\n\n            me.markers[id].setActivity(true);\n            me.panel = new LivecamPanel({camera: me.cameras[id]}).addTo(me.map);\n        }\n    }\n\n    _onDeselection(event) {\n        if (event.selectionType === 'livecam') {\n            const me = this,\n                marker = me.markers[event.id];\n\n            if (marker) {\n                marker.setActivity(false);\n            }\n            if (me.panel) {\n                me.panel.remove();\n                delete me.panel;\n            }\n        }\n    }\n\n}\n\nexport default function() {\n    return new LivecamPlugin();\n}\n","var img = \"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 576 512'%3e%3c!--! Font Awesome Free 6.1.2 by %40fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0%2c Fonts: SIL OFL 1.1%2c Code: MIT License) Copyright 2022 Fonticons%2c Inc. --%3e%3cpath d='M384 112v288c0 26.51-21.49 48-48 48h-288c-26.51 0-48-21.49-48-48v-288c0-26.51 21.49-48 48-48h288C362.5 64 384 85.49 384 112zM576 127.5v256.9c0 25.5-29.17 40.39-50.39 25.79L416 334.7V177.3l109.6-75.56C546.9 87.13 576 102.1 576 127.5z'/%3e%3c/svg%3e\";\n  export default img;"],"names":["css","ref","insertAt","document","head","getElementsByTagName","style","createElement","type","firstChild","insertBefore","appendChild","styleSheet","cssText","createTextNode","addColor","url","color","encodedColor","replace","tagName","attributes","container","element","Object","assign","LivecamPanel","Panel","constructor","options","super","className","addTo","map","name","html","this","_options","camera","setTitle","lang","setHTML","LivecamPlugin","me","id","en","ja","ko","ne","pt","th","iconStyle","backgroundSize","backgroundImage","clockModes","viewModes","cameras","markers","_onSelection","bind","_onDeselection","onAdd","onEnabled","on","fetch","then","response","json","data","item","_addMarkers","onDisabled","off","panel","trackObject","remove","keys","onVisibilityChanged","visible","setVisibility","center","zoom","bearing","pitch","thumbnail","selection","selectionType","popup","Marker","setLngLat","getMapboxMap","flyTo","Popup","join","undefined","event","setActivity","marker"],"mappings":"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"}